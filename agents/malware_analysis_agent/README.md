# Malware Analysis Agent

**Version:** `1.0.0`

## Purpose

This agent specializes in analyzing suspicious code and files to identify malicious capabilities, behaviors, and potential security threats within the CyberAgents framework.

## Key Responsibilities

Based on the agent's configured `goal`:

- Analyze suspicious code and files.
- Identify malicious capabilities and behaviors.
- Provide detailed technical assessments of potential threats.
- Process and analyze file hashes (SHA256, MD5, SHA1).
- Integrate with external services like VirusTotal and Hybrid Analysis.

## Tools Used

This agent utilizes the following tools (defined in its configuration):

- `malware_analysis_tool` - Performs static and dynamic analysis using external services

## Configuration

The agent's behavior is configured via the `malware_analysis_agent.yaml` file located in its directory. Key configuration parameters include:

- `role`: Malware Analyst
- `goal`: Analyze suspicious code and files to identify malicious capabilities and behaviors.
- `backstory`: Background context defining the agent's expertise.
- `tools`: A list of tool names the agent can use (currently `["malware_analysis_tool"]`).
- `allow_delegation`: Whether the agent can delegate tasks (currently `false`).

Refer to the `schemas/agent_schema.yaml` for the complete configuration schema definition.

## Implementation Details

The agent is implemented using:
- Pydantic models for configuration validation
- YAML configuration loading with proper error handling
- CrewAI Agent framework for task execution

The agent leverages the `MalwareAnalysisTool` located in the `tools/malware_analysis_tool` directory, which:
- Performs static analysis on file hashes
- Interfaces with VirusTotal and Hybrid Analysis APIs
- Provides structured results from these external services

### Error Handling

The agent includes robust error handling for:
- Missing or invalid configuration files
- Schema validation errors
- Agent initialization failures
- Missing API keys for external services
- Invalid input formats

### API Keys

To use the full functionality of this agent, you'll need API keys for:
- VirusTotal API (set as VIRUSTOTAL_API_KEY environment variable)
- Hybrid Analysis API (set as HYBRID_ANALYSIS_API_KEY environment variable)

These can also be set in the tool.yaml configuration file.

## Usage Examples

### Analyzing a File Hash

```python
from agents.malware_analysis_agent.malware_analysis_agent import MalwareAnalysisAgent
from crewai import Crew, Task

# Initialize the agent
malware_agent = MalwareAnalysisAgent()

# Create a task for the agent
hash_analysis_task = Task(
    description="Analyze the SHA256 hash: 275a021bbfb6489e54d471899f7db9d1663fc695ec2fe2a2c4538aabf651fd0f",
    agent=malware_agent.agent
)

# Create a crew with just this agent
crew = Crew(
    agents=[malware_agent.agent],
    tasks=[hash_analysis_task]
)

# Run the analysis
result = crew.kickoff()
print(result)
```

### Within a Security Analysis Crew

This agent can also be used as part of the broader Security Analysis Crew where the SecurityManagerAgent delegates tasks to it.

## Change History

- **2025-04-13** - v`1.0.0` - Schema compliance, Pydantic validation, linting, and README update.
- Fixed Field() validation issues in Pydantic models 
- Created comprehensive error handling for missing configurations
- Ensured tool configurations are properly loaded
- Added detailed documentation 